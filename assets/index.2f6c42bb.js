const L=function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))c(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const y of i.addedNodes)y.tagName==="LINK"&&y.rel==="modulepreload"&&c(y)}).observe(document,{childList:!0,subtree:!0});function t(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerpolicy&&(i.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?i.credentials="include":a.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function c(a){if(a.ep)return;a.ep=!0;const i=t(a);fetch(a.href,i)}};L();const l={size:5,colors:["#c3f3c7","#a9e8b0","#9edba4","#76c47e","#71bd79","#67e174","#61ad69","#499e51","#418c48","#34783a"]},o={canPressDown:!0,canPressUp:!0,canPressLeft:!0,canPressRight:!0},r={interval:0,milliSeconds:0,seconds:0,minutes:0},w=e=>{switch(e){case 2:return l.colors[0];case 4:return l.colors[1];case 8:return l.colors[2];case 16:return l.colors[3];case 32:return l.colors[4];case 64:return l.colors[5];case 256:return l.colors[6];case 512:return l.colors[7];case 1024:return l.colors[8];case 2048:return l.colors[9];default:return}},C=(e,n)=>{for(let t=0;t<n*n;t++){const c=document.createElement("div");c.classList.add("game__cell-wrapper"),e.append(c)}},$=e=>{const n=document.createElement("div");return n.classList.add("game__cell"),n.style.backgroundColor=w(e),n.textContent=String(e),n},q=()=>Math.random()>.1?2:4,S=document.querySelector(".game__table"),h=document.querySelector(".game__end"),g=document.querySelector(".btn__start"),b=document.querySelector(".game__again"),_=document.querySelector(".game__win"),D=document.querySelector(".game__win-button"),P=document.querySelector(".game__win-input"),k=document.querySelector(".result__table"),p=document.querySelector("#minutes"),m=document.querySelector("#seconds"),f=document.querySelector("#milliseconds"),v=()=>{for(let e=0;e<l.size;e++)for(let n=0;n<l.size;n++){const t=document.querySelector(`#x${e}y${n}`);t&&t.remove()}r.seconds=0,m.textContent="0"+r.seconds,r.minutes=0,p.textContent="0"+r.minutes,r.milliSeconds=0,f.textContent="0"+r.milliSeconds},R=()=>{k.insertAdjacentHTML("beforeend",`<li class="result__item">
          <span class="result__name">${P.value}</span>|
          <span class="result__score">${Math.ceil(2048/(r.minutes*60+r.seconds))}</span>
          </li>`),P.value="",_.classList.remove("game__win-active"),v(),g.style.display=""},E=()=>{clearInterval(r.interval),_.classList.add("game__win-active"),o.canPressDown=!1,o.canPressUp=!1,o.canPressRight=!1,o.canPressLeft=!1,D.addEventListener("click",R)},d=(e,n,t)=>{const c=document.querySelector(`#x${t}y${n}`);c&&(c.remove(),e.textContent=String(+e.textContent*1024),e.style.backgroundColor=w(+e.textContent)),e.textContent==="2048"&&E(),e.style.left=n*20+"%",e.style.top=t*20+"%",e.id=`x${t}y${n}`},U=e=>{let n,t,c=0;do if(n=Math.floor(Math.random()*l.size),t=Math.floor(Math.random()*l.size),++c===50)return;while(s[t][n]);return d(e,n,t),s[t][n]=Number(e.textContent),e},u=()=>{const e=U($(q()));!e||S.append(e)},A=e=>{const n=new Array(e);for(let t=0;t<e;t++){n[t]=new Array(e);for(let c=0;c<e;c++)n[t][c]=0}return n},M=()=>{o.canPressLeft=!1;for(let e=0;e<l.size;e++)for(let n=1;n<l.size;n++)if(s[e][n]){let t=n;for(;t!=0;){if(s[e][t-1]===s[e][t]){s[e][t-1]=s[e][t-1]+s[e][t],s[e][t]=0;const c=document.querySelector(`#x${e}y${t}`);d(c,t-1,e),o.canPressLeft=!0}else if(s[e][t-1]===0){const c=document.querySelector(`#x${e}y${t}`);s[e][t-1]=s[e][t],s[e][t]=0,d(c,t-1,e),o.canPressLeft=!0}t--}}},z=()=>{new Promise(e=>{o.canPressDown&&(M(),e())}).then(()=>{u(),u()})},G=()=>{o.canPressUp=!1;for(let e=0;e<l.size;e++)for(let n=1;n<l.size;n++)if(s[n][e]){let t=n;for(;t!=0;){if(s[t-1][e]===s[t][e]){s[t-1][e]=s[t-1][e]+s[t][e],s[t][e]=0;const c=document.querySelector(`#x${t}y${e}`);d(c,e,t-1),o.canPressUp=!0}else if(s[t-1][e]===0){s[t-1][e]=s[t][e],s[t][e]=0;const c=document.querySelector(`#x${t}y${e}`);d(c,e,t-1),o.canPressUp=!0}t--}}},I=()=>{new Promise(e=>{o.canPressDown&&(G(),e())}).then(()=>{u(),u()})},j=()=>{o.canPressDown=!1;for(let e=4;e>=0;e--)for(let n=3;n>=0;n--)if(s[n][e]){let t=n;for(;t!=4;){if(s[t+1][e]===s[t][e]){s[t+1][e]=s[t+1][e]+s[t][e],s[t][e]=0;const c=document.querySelector(`#x${t}y${e}`);d(c,e,t+1),o.canPressDown=!0}else if(s[t+1][e]===0){const c=document.querySelector(`#x${t}y${e}`);s[t+1][e]=s[t][e],s[t][e]=0,d(c,e,t+1),o.canPressDown=!0}t++}}},N=()=>{new Promise(e=>{o.canPressDown&&(j(),e())}).then(()=>{u(),u()})},O=()=>{o.canPressRight=!1;for(let e=4;e>=0;e--)for(let n=3;n>=0;n--)if(s[e][n]){let t=n;for(;t!=4;){if(s[e][t+1]===s[e][t]){s[e][t+1]=s[e][t+1]+s[e][t],s[e][t]=0;const c=document.querySelector(`#x${e}y${t}`);d(c,t+1,e),o.canPressRight=!0}else if(s[e][t+1]===0){s[e][t+1]=s[e][t],s[e][t]=0;const c=document.querySelector(`#x${e}y${t}`);d(c,t+1,e),o.canPressRight=!0}t++}}},T=()=>{new Promise(e=>{o.canPressDown&&(O(),e())}).then(()=>{u(),u()})},B=e=>{switch(e.key){case"ArrowLeft":e.preventDefault(),z();break;case"ArrowUp":e.preventDefault(),I();break;case"ArrowDown":e.preventDefault(),N();break;case"ArrowRight":e.preventDefault(),T();break}},F=()=>{v(),h.classList.remove("game__end-active"),x()},H=()=>{console.log(r.interval),clearInterval(r.interval),h.classList.add("game__end-active"),b.addEventListener("click",F),o.canPressDown=!1,o.canPressUp=!1,o.canPressRight=!1,o.canPressLeft=!1},K=()=>{!o.canPressLeft&&!o.canPressRight&&!o.canPressDown&&!o.canPressUp&&H()},W=()=>{r.milliSeconds++,r.milliSeconds<9&&(f.textContent="0"+r.milliSeconds),r.milliSeconds>9&&(f.textContent=String(r.milliSeconds)),r.milliSeconds>99&&(r.seconds++,m.textContent="0"+r.seconds,r.milliSeconds=0,f.textContent="0"+r.milliSeconds),r.seconds<=9&&(m.textContent="0"+r.seconds),r.seconds>9&&(m.textContent=String(r.seconds)),r.seconds>59&&(r.minutes++,p.textContent="0"+r.minutes,r.seconds=0,m.textContent="0"+r.seconds),r.minutes>9&&(p.textContent=String(r.minutes))};let s=[];const x=()=>{s=A(l.size),u(),u(),document.addEventListener("keydown",e=>{B(e),K()}),r.interval=setInterval(W,10),g.style.display="none",o.canPressDown=!0,o.canPressUp=!0,o.canPressRight=!0,o.canPressLeft=!0};C(S,l.size);g.addEventListener("click",()=>{x()});
