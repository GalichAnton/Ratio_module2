const L=function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))o(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const f of i.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&o(f)}).observe(document,{childList:!0,subtree:!0});function t(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerpolicy&&(i.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?i.credentials="include":a.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(a){if(a.ep)return;a.ep=!0;const i=t(a);fetch(a.href,i)}};L();const l={size:5,colors:["#c3f3c7","#a9e8b0","#9edba4","#76c47e","#71bd79","#67e174","#61ad69","#499e51","#418c48","#34783a"]},r={canPressDown:!0,canPressUp:!0,canPressLeft:!0,canPressRight:!0},c={interval:0,milliSeconds:0,seconds:0,minutes:0},w=e=>{switch(e){case 2:return l.colors[0];case 4:return l.colors[1];case 8:return l.colors[2];case 16:return l.colors[3];case 32:return l.colors[4];case 64:return l.colors[5];case 256:return l.colors[6];case 512:return l.colors[7];case 1024:return l.colors[8];case 2048:return l.colors[9];default:return}},$=(e,s)=>{for(let t=0;t<s*s;t++){const o=document.createElement("div");o.classList.add("game__cell-wrapper"),e.append(o)}},q=e=>{const s=document.createElement("div");return s.classList.add("game__cell"),s.style.backgroundColor=w(e),s.textContent=String(e),s},C=()=>Math.random()>.1?2:4,S=document.querySelector(".game__table"),h=document.querySelector(".game__end"),p=document.querySelector(".btn__start"),b=document.querySelector(".game__again"),_=document.querySelector(".game__win"),D=document.querySelector(".game__win-button"),g=document.querySelector(".game__win-input"),k=document.querySelector(".result__table"),v=()=>{for(let e=0;e<l.size;e++)for(let s=0;s<l.size;s++){const t=document.querySelector(`#x${e}y${s}`);t&&t.remove()}c.seconds=0,c.minutes=0,c.milliSeconds=0},R=()=>{k.insertAdjacentHTML("beforeend",`<li class="result__item">
          <span class="result__name">${g.value}</span>|
          <span class="result__score">${Math.ceil(2048/(c.minutes*60+c.seconds))}</span>
          </li>`),g.value="",_.classList.remove("game__win-active"),v(),p.style.display=""},E=()=>{clearInterval(c.interval),_.classList.add("game__win-active"),r.canPressDown=!1,r.canPressUp=!1,r.canPressRight=!1,r.canPressLeft=!1,D.addEventListener("click",R)},d=(e,s,t)=>{const o=document.querySelector(`#x${t}y${s}`);o&&(o.remove(),e.textContent=String(+e.textContent*1024),e.style.backgroundColor=w(+e.textContent)),e.textContent==="2048"&&E(),e.style.left=s*20+"%",e.style.top=t*20+"%",e.id=`x${t}y${s}`},U=e=>{let s,t,o=0;do if(s=Math.floor(Math.random()*l.size),t=Math.floor(Math.random()*l.size),++o===50)return;while(n[t][s]);return d(e,s,t),n[t][s]=Number(e.textContent),e},u=()=>{const e=U(q(C()));!e||S.append(e)},A=e=>{const s=new Array(e);for(let t=0;t<e;t++){s[t]=new Array(e);for(let o=0;o<e;o++)s[t][o]=0}return s},M=()=>{r.canPressLeft=!1;for(let e=0;e<l.size;e++)for(let s=1;s<l.size;s++)if(n[e][s]){let t=s;for(;t!=0;){if(n[e][t-1]===n[e][t]){n[e][t-1]=n[e][t-1]+n[e][t],n[e][t]=0;const o=document.querySelector(`#x${e}y${t}`);d(o,t-1,e),r.canPressLeft=!0}else if(n[e][t-1]===0){const o=document.querySelector(`#x${e}y${t}`);n[e][t-1]=n[e][t],n[e][t]=0,d(o,t-1,e),r.canPressLeft=!0}t--}}},z=()=>{new Promise(e=>{r.canPressDown&&(M(),e())}).then(()=>{u(),u()})},G=()=>{r.canPressUp=!1;for(let e=0;e<l.size;e++)for(let s=1;s<l.size;s++)if(n[s][e]){let t=s;for(;t!=0;){if(n[t-1][e]===n[t][e]){n[t-1][e]=n[t-1][e]+n[t][e],n[t][e]=0;const o=document.querySelector(`#x${t}y${e}`);d(o,e,t-1),r.canPressUp=!0}else if(n[t-1][e]===0){n[t-1][e]=n[t][e],n[t][e]=0;const o=document.querySelector(`#x${t}y${e}`);d(o,e,t-1),r.canPressUp=!0}t--}}},I=()=>{new Promise(e=>{r.canPressDown&&(G(),e())}).then(()=>{u(),u()})},j=()=>{r.canPressDown=!1;for(let e=4;e>=0;e--)for(let s=3;s>=0;s--)if(n[s][e]){let t=s;for(;t!=4;){if(n[t+1][e]===n[t][e]){n[t+1][e]=n[t+1][e]+n[t][e],n[t][e]=0;const o=document.querySelector(`#x${t}y${e}`);d(o,e,t+1),r.canPressDown=!0}else if(n[t+1][e]===0){const o=document.querySelector(`#x${t}y${e}`);n[t+1][e]=n[t][e],n[t][e]=0,d(o,e,t+1),r.canPressDown=!0}t++}}},N=()=>{new Promise(e=>{r.canPressDown&&(j(),e())}).then(()=>{u(),u()})},O=()=>{r.canPressRight=!1;for(let e=4;e>=0;e--)for(let s=3;s>=0;s--)if(n[e][s]){let t=s;for(;t!=4;){if(n[e][t+1]===n[e][t]){n[e][t+1]=n[e][t+1]+n[e][t],n[e][t]=0;const o=document.querySelector(`#x${e}y${t}`);d(o,t+1,e),r.canPressRight=!0}else if(n[e][t+1]===0){n[e][t+1]=n[e][t],n[e][t]=0;const o=document.querySelector(`#x${e}y${t}`);d(o,t+1,e),r.canPressRight=!0}t++}}},T=()=>{new Promise(e=>{r.canPressDown&&(O(),e())}).then(()=>{u(),u()})},B=e=>{switch(e.key){case"ArrowLeft":e.preventDefault(),z();break;case"ArrowUp":e.preventDefault(),I();break;case"ArrowDown":e.preventDefault(),N();break;case"ArrowRight":e.preventDefault(),T();break}},F=()=>{v(),h.classList.remove("game__end-active"),x()},H=()=>{console.log(c.interval),clearInterval(c.interval),h.classList.add("game__end-active"),b.addEventListener("click",F),r.canPressDown=!1,r.canPressUp=!1,r.canPressRight=!1,r.canPressLeft=!1},K=()=>{!r.canPressLeft&&!r.canPressRight&&!r.canPressDown&&!r.canPressUp&&H()},P=document.querySelector("#minutes"),m=document.querySelector("#seconds"),y=document.querySelector("#milliseconds"),W=()=>{c.milliSeconds++,c.milliSeconds<9&&(y.textContent="0"+c.milliSeconds),c.milliSeconds>9&&(y.textContent=String(c.milliSeconds)),c.milliSeconds>99&&(c.seconds++,m.textContent="0"+c.seconds,c.milliSeconds=0,y.textContent="0"+c.milliSeconds),c.seconds<=9&&(m.textContent="0"+c.seconds),c.seconds>9&&(m.textContent=String(c.seconds)),c.seconds>59&&(c.minutes++,P.textContent="0"+c.minutes,c.seconds=0,m.textContent="0"+c.seconds),c.minutes>9&&(P.textContent=String(c.minutes))};let n=[];const x=()=>{n=A(l.size),u(),u(),document.addEventListener("keydown",e=>{B(e),K()}),c.interval=setInterval(W,10),p.style.display="none",r.canPressDown=!0,r.canPressUp=!0,r.canPressRight=!0,r.canPressLeft=!0};$(S,l.size);p.addEventListener("click",()=>{x()});
